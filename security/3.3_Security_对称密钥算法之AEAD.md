# 3.3_Security_对称密钥算法之AEAD

简单的说，把[3.0_Security_对称密钥算法加解密](https://github.com/carloscn/blog/issues/137)和[3.2_Security_对称密钥算法之MAC（CMAC/HMAC）](https://github.com/carloscn/blog/issues/144)结合在一起，就是AEAD。全称为：**[Authenticated](https://en.wikipedia.org/wiki/Authenticated) Encryption** (**AE**) and **Authenticated Encryption with Associated Data** (**AEAD**)

对于AEAD的编程接口：
* 加密：
	* 输入：明文、密钥、header（未加密，可选）；
	* 输出：密文和MAC（tag）
* 解密：
	* 输入：密文，密钥，tag，header（在加密的时候使用的，可选）
	* 输出：明文，验证tag的结果，如果有header也有验证header的结果；

注意，header的目的是提供认证和完整性的保护，应用场景在网络和存储的[metadata](https://baike.baidu.com/item/%E5%85%83%E6%95%B0%E6%8D%AE/1946090)，是对不需要保证安全性但是需要认证功能的数据。

常用的AEAD包含：

- [CCM](https://en.wikipedia.org/wiki/CCM_mode)
-   [ChaCha20-Poly1305](https://en.wikipedia.org/wiki/ChaCha20-Poly1305 "ChaCha20-Poly1305")
-   [CWC](https://en.wikipedia.org/wiki/CWC_mode "CWC mode")
-   [EAX](https://en.wikipedia.org/wiki/EAX_mode "EAX mode")
-   [GCM](https://en.wikipedia.org/wiki/Galois/Counter_Mode "Galois/Counter Mode")
-   [IAPM](https://en.wikipedia.org/wiki/IAPM_(mode) "IAPM (mode)")
-   [OCB](https://en.wikipedia.org/wiki/OCB_mode "OCB mode")

# 1. 安全背景

对称加密算法只能提供保密性，MAC只能提供认证的功能，如果想让两个结合，那么就需要人工的使用加密算法及MAC，这种组合是多种多样的，并没有一个完善的标准规定，而且易错(error prone)。大量的攻击可以侵入，由于加密+认证错误的实现。大概2000年的时候，[Charanjit Jutla](https://en.wikipedia.org/w/index.php?title=Charanjit_Jutla&action=edit&redlink=1 "Charanjit Jutla (page does not exist)")，这个人集成了CBC模式的加密与认证混合的工具IAPM mode。在2009年，又逐步的定义了6种认证加密模式：
* [offset codebook mode 2.0](https://en.wikipedia.org/wiki/OCB_mode "OCB mode"), OCB 2.0; 
* [Key Wrap](https://en.wikipedia.org/wiki/Key_Wrap "Key Wrap"); 
* [counter with CBC-MAC](https://en.wikipedia.org/wiki/CCM_mode "CCM mode") CCM; 
* [encrypt then authenticate then translate](https://en.wikipedia.org/wiki/EAX_mode "EAX mode"), EAX; 
* [encrypt-then-MAC](https://en.wikipedia.org/wiki/Encrypt-then-MAC "Encrypt-then-MAC"), EtM; 
* [Galois/counter mode](https://en.wikipedia.org/wiki/Galois/counter_mode "Galois/counter mode"), GCM)

在2013年，[CAESAR competition](https://en.wikipedia.org/wiki/CAESAR_Competition) 推行认证加密模式。在2015年，[ChaCha20-Poly1305](https://en.wikipedia.org/wiki/ChaCha20-Poly1305)被加入到GCM中。

至此，一种又可以加密又可以保证完整性的算法工具诞生了。

# 2. AEAD

## 2.1 AEAD方法

### 2.1.1 Encrypt-then-MAC (EtM)

### 2.1.2 Encrypt-and-MAC (E&M)

### 2.1.3 MAC-then-Encrypt (MtE)

