# 1. 背景与意义

Uptane框架是一款灵活、多层次结构的车载软件在线更新安全体系框架，支持用户OTA可定制化，能够防止攻击者对车辆造成多种类型的伤害。使用风险评估的方法发现Uptane框架目前存在的主要缺陷是框架不具备**抵御拒绝服务攻击和密钥泄露**后的中间人攻击的能力。

一个完整的车载OTA系统包含云端系统、车端中央域控制器或者网关、微控制器。管理员通过云端服务系统下发软件更新包，软件包经过以太网传输至车端网关或者中央域控制器，再过CAN网络等汽车现场总线下发至需要更新的ECU。OTA虽然便捷，但端到端传输自动化，中间环节扁平化带来的不可控因素都是网联车辆潜在的安全隐患。

目前各设备制造商们(Original Equipment Manufacturer,OEM)在OTA安全方面主要是运用PKI体系进行最基本的防护，在安全机制上没有进行较多的设计。2009年诞生的
安全更新框架TUF(The Update Framework)，主要用于保护软件更新安全。TUF在云
端生成更新数据的元数据签名，通过验证元数据来阻止攻击。TUF即用即插的特性使其
在软件更新领域被广泛应用，但却不适用于车端。车端的软件更新需要较强的可定制性，TUF只维护一个镜像存储库，这使得TUF在同一时间不同的设备上只能下发同一种数据。

Upatne框架诞生于2017年，基于广泛使用的TUF发展而来，主要为汽车行业提供软件更新时的安全防护。Uptane框架不仅维护镜像库，还维护一个指令库，可以实现在同一时间为不同的汽车下发不同的更新数据，满足了汽车行业更新可定制化的需求。2018年，Asokan等人在Uptane的基础上优化，提出了ASSURED安全框架，通过token进行身份验证，解决了Uptane框架需要制造商和设备之间直接交互的问题，通过ARM Trustzone技术，保护密钥和加密过程的安全。可信执行环境(Trusted Execution Environment,TEE)技术在物联网领域广泛被运用。

# 2. 相关理论基础和关键技术

## 2.1 车载软件更新相关理论和标准
### 2.1.1 汽车整车电子电气架构

汽车整车电子电气架构(Electrical/Electronic Architecture,EEA)为汽车OTA提供良好
的实现环境，是实现汽车OTA的基础。随着汽车交互性的加强，传统分散的汽车电子电气架构已经不适用于现代汽车。目前汽车采用的大部分是以智能网关为中心的分布式
架构，如图2-1就是一个典型的以智能网关为中心的分布式架构：

![](https://raw.githubusercontent.com/carloscn/images/main/typoratypora202303101434895.png)

随着汽车智能化，不同厂商制造的ECU之间交互频繁，算法更复杂，传统的电子电气架构容易出现中心网关算力压力加大、软件之间系统无法兼容等问题，增加了汽车OTA的实现难度。因此，下一代智能网联汽车的车内网络系统结构将逐步转向领域集中的分布式结构：

![](https://raw.githubusercontent.com/carloscn/images/main/typora202303101435029.png)

该结构以一定标准划分区域，可能是功能也可能是位置等等，并在每个域中加入域控制器(Domain Controller,DC)。域控制器下的ECU的执行指令都由域控制器下发，ECU不再担任决策者，而是单纯的命令执行者。**域控制器的出现解决了不同厂商制造的ECU之间耦合度低、各软件系统不兼容的问题**。

### 2.1.2 车载软件更新相关标准


R155法案是联合国世界车辆法规协调论坛(UN/WP.29)2020年发布的关于认证车辆在网络安全及网络安全管理处理系统方面的规定[30]，法案于2021年1月22日生效，规定了所有车辆必须通过网络安全管理体系(Cyber Security Management System,CSMS)认
证和车辆网络安全型式认证(Vehicle Type Approval,VTA)，并列出了7大类网络安全威
胁和漏洞类别、69种攻击，其中有关车载软件更新的常见攻击方式如表2-1。表2-1中提到的攻击可以概括为三类，第一类是对更新程序或者固件进行攻击，第二类是在更新之前对下发的软件数据进行攻击，第三类是针对设备发起的拒绝服务攻击。由此可见，OTA防护首先要对更新程序进行防护，对更新程序进行加密、混淆等处理，要求更新程序有一定的健壮性[31-32]，在固件部分被损坏的情况下，框架不至于瘫痪造成更大的失。对于服务端需要有更高级的防护机制，避免在更新之前软件已经被篡改。数据在路中需加密传输，各级转发节点以及车载终端应当具备数据验证、加密、解密等基本密码学功能模块。对于硬件资源有限的嵌入式设备设计抵御拒绝服务攻击的安全机制。

![](https://raw.githubusercontent.com/carloscn/images/main/typora202303101438509.png)


R156法案是由联合国欧洲经委会(UNECE)车辆法规协调世界论坛(WP.29)通过的新
的联合国法规。因为控制单元之间复杂性和相互依赖性的增加，所以必须验证软件存在性、合理性以及兼容性，ECU必须能够确保在其他ECU上运行的软件的完整性，以保证其自身的正确运行[34]。还需评估软件更新后的安全性和对车型认证的影响等等，所以OTA安全更新框架需要具备记录软件版本的功能和记录更新推送的功能。

![](https://raw.githubusercontent.com/carloscn/images/main/typora202303101439903.png)
